# 电影院选座系统说明文档
组长：曹景琦
组员：王长盛 夏熠 李颖
## 一、项目简介
本项目为“电影院选座系统”，旨在实现电影院座位的可视化选取、购票、预订、退票等功能，支持个人和团体购票，具备自动选座、座位状态实时更新、信息本地存储等特性。系统采用 HTML5、CSS3 和原生 JavaScript 实现，前端界面美观，交互友好，适合实际影院场景应用。
## 二、实现思路
#### 1.总体框架
系统采用模块化设计，主要分为以下几个功能模块：
* CanvasDraw：负责座位的弧形可视化绘制。
* SeatSelect：处理座位的点击选择、自动选座等逻辑。
* TicketManager：管理购票、预订、退票及本地存储。
* ConfigUI：负责票种切换、团体成员信息输入等 UI 交互。

主控制器 CinemaSeating 负责各模块的初始化与数据流转
####  2.座位可视化
1. 为了模拟真实影院的观影体验，系统将所有座位以弧形方式排布，而不是简单的矩形网格。每一排的座位都分布在一个圆弧上，排数越大（越靠后），弧的半径越大，整体呈现“扇形”效果。
2. 在 drawSeats() 方法中，遍历所有排和每排的座位，调用 drawSeat(row, seat) 进行绘制。每个座位用 arc 方法绘制为圆形，颜色根据状态（空座、已选、已售）动态变化。座位号绘制在圆形中央，便于用户识别。通过 save() 和 restore() 保证每个座位的绘制互不影响。
3. 在每排的最左和最右侧，绘制排号（如“第1排”），方便用户定位。排号的位置通过在首尾座位的坐标基础上平移一定距离实现。
4. 每次座位状态变化（如选座、购票、退票）后，都会重新调用 drawSeats()，保证画布内容实时更新。通过监听 canvas 的点击事件，实现座位的选中与切换。
#### 3.选座与自动选座
1. 通过在 Canvas 元素上绑定 click 事件，获取用户点击的像素坐标。遍历所有座位，利用三角函数计算每个座位的圆心坐标，并判断点击点到圆心的距离是否小于等于座位半径，从而判断用户点击的是哪个座位。判断该座位是否可选（未被占用），然后根据是否按下 Ctrl 键决定是多选还是单选：
    * 单选时，清空已选座位集合，只保留当前点击的座位；
    * 多选时，切换当前座位的选中状态（已选则取消，未选则加入）。

    选中状态存储在 selectedSeats 集合中，选座后调用 drawSeats() 重新绘制座位图，实时反映选中效果。
2. 绑定“自动选座”按钮的点击事件，获取用户输入的年龄。根据年龄判断可选排数范围：
    * 少年（<15岁）不能选前3排；
    * 老年（>60岁）不能选后3排；
    * 其他年龄可选全部排。

    遍历可选排的所有座位，收集所有可用且未被选中的座位。为了支持多次点击自动选座切换方案，记录上一次自动选中的座位，每次优先推荐未被选中过的座位。找到合适座位后，将其加入 selectedSeats，并刷新座位图。
3. 绑定“团体自动选座”按钮的点击事件，获取团体人数和所有成员的年龄。
对每一排，判断该排是否满足所有成员的年龄限制。在满足条件的排中，查找长度等于团体人数的连续空座位块，并确保这些座位未被上次自动选中过。
若找到合适的连续座位块，则将所有座位加入 selectedSeats，并刷新座位图。
若没有新方案，则允许重复上次方案，只要这些座位仍然可用。
#### 4.购票与预订
1. 在系统初始化时，TicketManager 会为“预订”和“直接购买”按钮绑定点击事件，统一调用 handleSubmit() 方法处理购票逻辑。
2. 首先判断当前选择的是个人票还是团体票。
    * 个人票：校验姓名和年龄输入是否完整，要求用户必须填写。
    * 团体票：校验团体人数、成员信息输入框数量与人数一致，并逐一检查每位成员的姓名和年龄是否填写完整。

    若校验不通过，弹窗提示用户补全信息，流程中止。
3. 个人票将姓名、年龄和所选座位打包为一个对象，加入预订数据数组。
团体票将每位成员的姓名、年龄和分配的座位打包为成员对象数组，再整体加入预订数据数组。
4. 校验通过后，将所选座位的状态设置为“已售”（occupied），并清空当前已选座位集合。同时调用 drawSeats() 刷新座位图，实时反映状态变化。通过 saveReservations() 方法，将本次预订数据追加保存到浏览器的 localStorage，实现购票信息的持久化。
购票或预订成功后，弹窗提示“操作成功，座位已锁定！”。同时刷新右侧已选座位和总价显示，提升用户体验。
5. 退票和取消选择功能通过按钮触发，分别将对应座位状态恢复为“空座”，并同步刷新界面和本地存储。
6. 每次系统初始化时，restoreReservations() 方法会从 localStorage 读取所有历史预订数据，将对应座位恢复为“已售”状态，保证页面刷新后数据不丢失。
## 三、使用说明
1. 打开 index.html，即可进入系统主界面。
2. 在座位图上点击座位进行选择，Ctrl+点击可多选。
3. 选择票种（个人票/团体票），填写对应信息。
4. 可点击“自动选座”或“团体自动选座”按钮，系统将根据规则自动分配座位。
5. 点击“预订”或“直接购买”完成购票，座位状态变为已售。
6. 购票信息和座位状态会自动保存，刷新页面不会丢失。
可通过“取消选择”按钮清空当前选择。
## 四、遇到的问题和解决方法
1. 关于如何将座位均匀分布在弧线上，且排与排之间间距合理，我们通过三角函数计算每个座位的坐标，动态调整弧半径和角度范围，保证视觉美观。
2. 关于如何根据年龄自动筛选合适的座位，且多次点击能切换方案，我们在自动选座时先筛选符合年龄的排，再查找可用座位，并记录上次自动选座结果，避免重复。
3. 关于团体成员需分配同排连续座位，且所有成员年龄规则需同时满足，我们通过遍历所有排，逐一查找满足条件的连续空座块，并校验所有成员年龄限制，解决了这一问题。
4. 关于如何保证购票信息和座位状态在刷新后不丢失，我们将购票的信息存入 localStorage，页面加载时自动恢复。
5. 关于团体成员信息输入复杂、人数不定，我们采取动态生成输入框并校验完整性的方法，确保信息完整准确。
## 五、参考资料
1. MDN Web Docs - Canvas API
2. MDN Web Docs - localStorage
3. JavaScript 事件处理与 DOM 操作
4. HTML5 Canvas 绘图基础
5. CSS Flexbox 布局教程
6. 小组成员课堂笔记与讨论记录